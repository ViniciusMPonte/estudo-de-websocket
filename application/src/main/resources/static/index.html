<!DOCTYPE html>
<html>
<head>
    <title>Chat Simples</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 50px auto; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
        .message { margin: 5px 0; padding: 5px; background: #f0f0f0; border-radius: 5px; }
        .sender { font-weight: bold; color: #0066cc; }
        input { width: 70%; padding: 10px; }
        button { width: 25%; padding: 10px; }
    </style>
</head>
<body>
<h1>Chat em Tempo Real</h1>

<div>
    <input type="text" id="username" placeholder="Seu nome" />
    <button onclick="connect()">Conectar</button>
    <button onclick="disconnect()">Desconectar</button>
</div>

<div id="messages"></div>

<div>
    <input type="text" id="messageInput" placeholder="Digite sua mensagem..." />
    <button onclick="sendMessage()">Enviar</button>
</div>

<script>
    let stompClient = null;

    function connect() {
        const username = document.getElementById('username').value;
        if (!username) {
            alert('Digite seu nome!');
            return;
        }

        const socket = new SockJS('https://estudo-de-websocket.onrender.com/chat');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function(frame) {
            console.log('Conectado: ' + frame);

            stompClient.subscribe('/topic/messages', function(message) {
                showMessage(JSON.parse(message.body));
            });

            alert('Conectado ao chat!');
        });
    }

    function disconnect() {
        if (stompClient !== null) {
            stompClient.disconnect();
        }
        console.log('Desconectado');
    }

    function sendMessage() {
        const username = document.getElementById('username').value;
        const messageContent = document.getElementById('messageInput').value;

        if (!messageContent) return;

        stompClient.send("/app/sendMessage", {}, JSON.stringify({
            'sender': username,
            'content': messageContent
        }));

        document.getElementById('messageInput').value = '';
    }

    function showMessage(message) {
        const messagesDiv = document.getElementById('messages');
        const messageElement = document.createElement('div');
        messageElement.className = 'message';
        messageElement.innerHTML = '<span class="sender">' + message.sender + ':</span> ' + message.content;
        messagesDiv.appendChild(messageElement);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    document.getElementById('messageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') sendMessage();
    });
</script>
</body>
</html>